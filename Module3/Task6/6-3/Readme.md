Псевдозаголовок сетевого уровня заполняется сам благодаря bind(), его определять не нужно. Заголовок транспортного уровня достаточно заполнить только на половину: в 3-4 байты записать порт получателя, в 6-7 байты - длину пакета (размер сообщения + 8 байтов заголовка транспортного уровня). В конце дописать данные в датаграмму.