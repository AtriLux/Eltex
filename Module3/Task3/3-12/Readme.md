Количество пользователей чата ограничено 8 процессами. Доступны идентификаторы от 2 до 9. 1 идентификатор занят сервером.

Каждый пользователь имеет свою личную очередь, в том числе и сервер. Все пользователи сначала пишут серверу в качестве приоритета выставляя свои идентификаторы. Сервер разбирает полученные сообщения на составляющие: получателя и текст сообщения. Далее отправляет текст сообщения в очередь определенного ранее получателя.

При входе нового пользователя происходит подключение к серверу. В этот момент пользователь отправляет пустое сообщение и свой идентификатор (как приоритет). Сервер открывает для себя личную очередь нового пользователя и заносит данные в 2 массива: один для идентификаторов пользователей, второй для идентификаторов очередей. В конце сервер отправляет ответное пустое письмо, уведомляющее пользователя, что он подключен к сети.

Таким образом, у каждого пользователя всегда открыты 2 очереди: личная для чтения сообщений с сервера и общая серверная для отправки сообщений на сервер. У сервера обязательно открыта личная очередь для принятия новых сообщений и динамически открываются новые очереди по мере подключения клиентов. В эти очереди сервер пересылает сообщения. Подобное деление очередей позволяет передовать в качестве приоритета идентификаторы отправителей сообщений, поэтому при просмотре сообщений отображается идентификатор отправителя (чат больше не анонимный по сравнению с 3-9)

Очереди сервера не удаляются и не закрываются, поскольку предполагается, что сервер работает без остановки. Очереди у клиентов закрываются в момент их выхода из чата.

На тестовом изображении показан запущенный сервер в левом верхнем углу, отправка сообщений пользователем 2 в нижнем левом углу всем пользователям и только пользователю 3, проверка сообщений пользователями 3 и 4 в верхнем правом и нижнем правом углах соответственно.
